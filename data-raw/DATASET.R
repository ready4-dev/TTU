## This script creates the data files embedded with this package.
## As it involves interaction, it must be run  in four separate parts.
##
## PART ONE
##
# 1. Load magrittr package to that the pipe operator ("%>%") can be used in this script.
library(magrittr)
# 2. Create "fns", "gnrcs" and "mthds" sub-directories.
ready4fun::write_fn_type_dirs()
# 3. MANUAL STEP. Write all your functions to R files in the new "fns" directory.
##
## PART TWO
##
# 4. Set-up package structure
ready4fun::make_pkg_desc_ls(pkg_title_1L_chr = "Transfer to Utility Mapping Algorithm Toolkit",
                            pkg_desc_1L_chr = "Tools for developping Transfer To Utility (TTU) mapping algorithms to predict health utility from other health measures.
  This development version of the TTU package has been made available as part of the process of testing and documenting the package. The tools contained in this development release automate a number of tasks which MODIFY THE DIRECTORY STRUCTURE OF YOUR LOCAL MACHINE.
  Therefore you should only trial this software if you feel confident that you understand what it does and have created a sandpit area in which you can safely undertake testing. If you have any questions, please contact the authors (matthew.hamilton@orygen.org.au).
  The documentation for this package has been automatically generated by the ready4fun package and is therefore quite rudimentary. Human authored documentation will follow in 2021.",
                            authors_prsns = c(utils::person(given = "Caroline",family = "Gao",email = "caroline.gao@orygen.org.au", role = c("aut"),comment = c(ORCID = "0000-0002-0987-2759")),
                                              utils::person(given = "Matthew",family = "Hamilton",email = "matthew.hamilton@orygen.org.au", role = c("aut", "cre"),comment = c(ORCID = "0000-0001-7407-9194")),
                                              utils::person("Orygen", role = c("cph", "fnd")),
                                              utils::person("Headspace", role = c( "fnd")),
                                              utils::person("National Health and Medical Research Council", role = c( "fnd"))),
                            urls_chr = c("https://ready4-dev.github.io/TTU/",
                                         "https://github.com/ready4-dev/TTU",
                                         "https://ready4-dev.github.io/ready4/")) %>%
  ready4fun::write_pkg_setup_fls(incr_ver_1L_lgl = F,
                                 delete_contents_of_R_dir = T,
                                 copyright_holders_chr = "Orygen",
                                 check_type_1L_chr = "gh",
                                 path_to_pkg_logo_1L_chr = "../../../../../Documentation/Images/TTU-logo/default.png",
                                 github_repo = "ready4-dev/TTU",
                                 lifecycle_stage_1L_chr = "experimental",
                                 badges_lup = ready4fun::badges_lup,
                                 addl_badges_ls = list(ready4 = "modelling"))

# PAUSE FOR INTERACTIVE
classes_to_make_tb <- ready4class::ready4_constructor_tbl() %>%
  dplyr::bind_rows(tibble::tribble(
    ~ make_s3_lgl, ~ name_stub_chr, ~ pt_ls, ~ pt_chkr_pfx_ls, ~ pt_ns_ls, ~ vals_ls, ~ allowed_vals_ls, ~ min_max_vals_ls, ~ start_end_vals_ls, ~ class_desc_chr, ~ parent_class_chr, ~ slots_ls, ~ meaningful_nms_ls, ~inc_clss_ls,
    TRUE, "predictors_lup", list("tibble"), list("is_"),list("tibble"),list(short_name_chr = "character(0)",
                                                                            long_name_chr = "character(0)",
                                                                            min_val_dbl = "numeric(0)",
                                                                            max_val_dbl = "numeric(0)",
                                                                            class_chr = "character(0)",
                                                                            increment_dbl = "numeric(0)",
                                                                            class_fn_chr = "character(0)",
                                                                            mdl_scaling_dbl = "numeric(0)",
                                                                            covariate_lgl = "logical(0)"), NULL,NULL, NULL, "TTU S3 class for candidate predictors lookup table", NA_character_, NULL, NULL, NULL)
  )
name_pfx_1L_chr <- "TTU_"

pkg_dss_tb <- ready4fun::write_abbr_lup(short_name_chr = c(paste0(name_pfx_1L_chr,classes_to_make_tb$name_stub_chr)),
                                        long_name_chr = c(classes_to_make_tb$class_desc_chr),
                                        #no_plural_chr = ,
                                        #custom_plural_ls = ,
                                        url_1L_chr = NA_character_,
                                        seed_lup = ready4show::abbreviations_lup)
utils::data("abbreviations_lup")
pkg_dss_tb <- classes_to_make_tb %>%
  ready4class::write_classes_and_make_lup(dev_pkg_ns_1L_chr = ready4fun::get_dev_pkg_nm(),
                                          name_pfx_1L_chr = name_pfx_1L_chr,
                                          output_dir_1L_chr = "R",
                                          file_exists_cdn_1L_chr = "overwrite",
                                          abbreviations_lup = abbreviations_lup,
                                          init_class_pt_lup = ready4use::prototype_lup)  %>% #
  ready4fun::write_and_doc_ds(db_1L_chr = "prototype_lup",
                              title_1L_chr = "Class prototype lookup table",
                              desc_1L_chr = "Metadata on classes used in readyforwhatsnext suite",
                              pkg_dss_tb = pkg_dss_tb)
##
## PART THREE
##
# 5. Create a lookup table of abbreviations used in this package and save it as a package dataset (data gets saved in the data directory, documentation script is created in R directory).
#utils::data("abbreviations_lup",package = "ready4use")
pkg_dss_tb <- ready4fun::write_abbr_lup(short_name_chr = c("adol","aqol","aqol6d","aqol6dU",
                                                           "cnstr","con","cor",
                                                           "dim","disv","eq","lev",
                                                           "lgd",
                                                           "mdl",
                                                           "predn",
                                                           "q",
                                                           "scrg",
                                                           "tfmn",
                                                           "tot",
                                                           "ts",
                                                           "uid","ut","unscrd","vldn"),
                                        long_name_chr = c("adolescent",
                                                          "Assessment of Quality of Life",
                                                          "Assessment of Quality of Life Six Dimension",
                                                          "Assessment of Quality of Life Six Dimension Health Utility",
                                                          "constraint",
                                                          "constant",
                                                          "correlation",
                                                          "dimension",
                                                          "disvalue",
                                                          "equation",
                                                          "level",
                                                          "legend",
                                                          "model",
                                                          "prediction",
                                                          "question",
                                                          "scoring",
                                                          "transformation",
                                                          "total",
                                                          "time series",
                                                          "unique identifier",
                                                          "utility",
                                                          "unscored",
                                                          "validation"),
                                        no_plural_chr = c("Assessment of Quality of Life",
                                                            "Assessment of Quality of Life Six Dimension",
                                                            "Assessment of Quality of Life Six Dimension Health Utility",
                                                          "prediction","time series","validation"),
                                        custom_plural_ls = list(utility = "utilities"),
                                        url_1L_chr = NA_character_,
                                        seed_lup = ready4use::abbreviations_lup)
utils::data("abbreviations_lup")
##
# 5. Create function types and generics look-up tables
# 5.1 Create a lookup table of function types used in this package and save it as a package dataset (data gets saved in the data directory, documentation script is created in R directory).
utils::data("fn_type_lup_tb",package = "ready4use")
# ready4fun::get_new_fn_types(abbreviations_lup = abbreviations_lup,
#                             fn_type_lup_tb = fn_type_lup_tb)
pkg_dss_tb <- fn_type_lup_tb %>%
  ready4fun::add_rows_to_fn_type_lup(fn_type_nm_chr = ready4fun::get_new_fn_types(abbreviations_lup = abbreviations_lup,
                                                                                  fn_type_lup_tb = fn_type_lup_tb),
                                  fn_type_desc_chr = c("Calculates a numeric value.",
                                                       #"Extracts data from an object.",
                                                       "Fits a model of a specified type to a dataset",
                                                       "Imputes data.",
                                                       "Knits a rmarkdown file",
                                                       "Plots data",
                                                       "Makes predictions from data using a specified statistical model.",
                                                       "Prints output to console",
                                                       "Randomly samples from data.",
                                                       "Reorders an object to conform to a pre-specified schema.",
                                                       # "Resets the value of an object to a default.",
                                                       "Randomly reorders an object."
                                                       ),
                                  is_generic_lgl = F,
                                  is_method_lgl = F) %>% # Add to ready4fun template.
  dplyr::arrange(fn_type_nm_chr) %>%
  ready4fun::write_dmtd_fn_type_lup(url_1L_chr = NA_character_,
                                    abbreviations_lup = abbreviations_lup,
                                    pkg_dss_tb = pkg_dss_tb)
utils::data("fn_type_lup_tb")
#
# 6. Create a table of all functions to document
fns_dmt_tb <- ready4fun::make_dmt_for_all_fns(paths_ls = ready4fun::make_fn_nms()[1],
                                              undocumented_fns_dir_chr = ready4fun::make_undmtd_fns_dir_chr()[1],
                                              custom_dmt_ls = list(details_ls = NULL,
                                                                   inc_for_main_user_lgl_ls = list(force_true_chr = c("add_adol6d_scores",
                                                                                                                      "add_utility_predn_to_ds",
                                                                                                                      "make_fake_ts_data",
                                                                                                                      "write_all_alg_outps",
                                                                                                                      #"write_rprt",
                                                                                                                      "write_shareable_mdls",
                                                                                                                      "write_ts_mdls_from_alg_outp"),
                                                                                                   force_false_chr = NA_character_),
                                                                   args_ls_ls = NULL),
                                              fn_type_lup_tb = fn_type_lup_tb,
                                              abbreviations_lup = abbreviations_lup)
##
pkg_dss_tb <- fns_dmt_tb %>%
  ready4fun::write_and_doc_ds(db_1L_chr = "fns_dmt_tb",
                              title_1L_chr = "TTU function documentation table",
                              desc_1L_chr = "Meta-data on each TTU function used to create package documentation",
                              url_1L_chr = "https://ready4-dev.github.io/TTU/",
                              abbreviations_lup = abbreviations_lup,
                              pkg_dss_tb = pkg_dss_tb)
pkg_dss_tb <- tibble::tibble(short_name_chr = c("OLS_NTF",
                                                     "OLS_LOG",
                                                     "OLS_LOGIT",
                                                     "OLS_LOGLOG",
                                                     "OLS_CLL",
                                                     "GLM_GSN_LOG",
                                                     "GLM_BNL_LOG",
                                                     "GLM_BNL_LGT",
                                                     "GLM_BNL_CLL",
                                                     "BET_LOG",
                                                     "BET_LGT",
                                                     "BET_CLL"),
                                  long_name_chr = c("Ordinary Least Squares (No transformation)",
                                                    "Ordinary Least Squares (Log transformation)",
                                                    "Ordinary Least Squares (Logit transformation)",
                                                    "Ordinary Least Squares (Log Log transformation)",
                                                    "Ordinary Least Squares (Complementary Log Log transformation)",
                                                    "Generalised Linear Mixed Model with Gaussian distribution and log link",
                                                    "Generalised Linear Mixed Model with Binomial distribution and log link",
                                                    "Generalised Linear Mixed Model with Binomial distribution and logit link",
                                                    "Generalised Linear Mixed Model with Binomial distribution and complementary log log link",
                                                    "Beta Regression Model with Binomial distribution and log link",
                                                    "Beta Regression Model with Binomial distribution and logit link",
                                                    "Beta Regression Model with Binomial distribution and complementary log log link")) %>%
  dplyr::mutate(control_chr = c(rep(NA_character_,9),rep("betareg::betareg.control",3)),
                family_chr = c(rep(NA_character_,5),"gaussian(log)","quasibinomial(log)","quasibinomial(logit)","quasibinomial(cloglog)", rep(NA_character_,3)),
                fn_chr = c(rep("lm",5),rep("glm",4),rep("betareg::betareg",3)),
                start_chr = c(rep(NA_character_,5),
                              rep("-0.1,-0.1",4),
                              rep("-0.5,-0.1,3",3)),

                pred_type_chr = c(rep(NA_character_,5),
                                  rep("response",7)),
                tfmn_chr = dplyr::case_when(startsWith(short_name_chr, "OLS_") ~ purrr::map_chr(short_name_chr, ~ {
                  idx_1L_int <- 1 + stringi::stri_locate_last_fixed(.x,"_")[1,1] %>% as.vector()
                  stringr::str_sub(.x, start = idx_1L_int)
                }),
                T ~ "NTF"),
                tfmn_for_bnml_lgl = c(rep(F,6),rep(T,3),rep(F,3))) %>%
  ready4fun::write_and_doc_ds(db_1L_chr = "mdl_types_lup",
                              title_1L_chr = "Model types lookup table",
                              desc_1L_chr = "A lookup table of abbreviations to describe the different model types supported by TTU functions",
                              abbreviations_lup = abbreviations_lup,
                              pkg_dss_tb = pkg_dss_tb)
pkg_dss_tb <- tibble::tibble(short_name_chr = c("coefs","hetg", "dnst","sctr_plt"),
                               long_name_chr = c("population level effects",
                                                 "group level effects",
                                                 "comparative densities of observed and predicted data",
                                                 "comparative scatter plot of obsereved and predicted data")) %>%
  ready4fun::write_and_doc_ds(db_1L_chr = "plt_types_lup",
                              title_1L_chr = "Model plot types lookup table",
                              desc_1L_chr = "A lookup table of abbreviations to describe the different model plot types supported by TTU functions",
                              abbreviations_lup = abbreviations_lup,
                              pkg_dss_tb = pkg_dss_tb)
pkg_dss_tb <- tibble::tibble(rprt_nms_chr = "Main_Mdl_Smry",
                           title_chr = "Summary report of the models estimated from synthetic data to map a number of mental health measures to utility scores.",
                           paths_to_RMD_dir_1L_chr = NA_character_,
                           pkg_dirs_chr = "Markdown",
                           packages_chr = "TTU",
                           nms_of_RMD_chr = "_Mdls_Report.RMD",
                           rltv_paths_to_outpt_yaml_chr = "_output.yml") %>%
  ready4fun::write_and_doc_ds(db_1L_chr = "rprt_lup",
                              title_1L_chr = "Report types lookup table",
                              desc_1L_chr = "A lookup table of the different report types supported by TTU functions",
                              abbreviations_lup = abbreviations_lup,
                              pkg_dss_tb = pkg_dss_tb)
##
pkg_dss_tb <- tibble::tribble(
  ~var_name_chr, ~coeff_dbl,
  "vD1", 0.0719264,
  "vD2", 0.1027818,
  "vD3", 0.2519563,
  "vD4", 0.3201172,
  "vD5", 0.1288289,
  "vD6", 0.2052164,
  "Constant", - 0.0444493
) %>% ready4fun::write_and_doc_ds(db_1L_chr = "aqol6d_from_8d_coeffs_lup_tb",
                                  title_1L_chr = "Model 2A Coefficients To Weight AQoL6D",
                                  desc_1L_chr = "Coefficients for model to predict AQoL-6D utility score from AQoL-8D. The optimal model is Model 2A (see Richardson et al (2011, 18-19)*/",
                                  url_1L_chr = "https://www.aqol.com.au/index.php/scoring-algorithms",
                                  abbreviations_lup = abbreviations_lup,
                                  pkg_dss_tb = pkg_dss_tb)
pkg_dss_tb <- tibble::tribble(
  ~Question_chr, ~Answer_1_dbl, ~Answer_2_dbl, ~Answer_3_dbl, ~Answer_4_dbl, ~Answer_5_dbl, ~Answer_6_dbl,
  "Q1", 0, 0.073, 0.435, 0.820, 1, NA_real_,
  "Q2", 0, 0.033, 0.240, 0.471, 0.840,1,
  "Q3", 0, 0.041, 0.251, 0.570, 0.830, 1,
  "Q4", 0, 0.040, 0.297, 0.797, 1, NA_real_,
  "Q5", 0, 0.074, 0.461, 0.841, 1, NA_real_,
  "Q6", 0, 0.193, 0.759, 1, NA_real_,NA_real_,
  "Q7", 0, 0.197, 0.648, 1, NA_real_, NA_real_,
  "Q8", 0, 0.133, 0.392, 0.838, 1, NA_real_,
  "Q9", 0, 0.142, 0.392, 0.824, 1, NA_real_,
  "Q10", 0, 0.097, 0.330, 0.784, 1, NA_real_,
  "Q11", 0, 0.064, 0.368, 0.837, 1, NA_real_,
  "Q12", 0, 0.056, 0.338, 0.722, 1, NA_real_,
  "Q13", 0, 0.055, 0.382, 0.774, 1, NA_real_,
  "Q14", 0, 0.057, 0.423, 0.826, 1, NA_real_,
  "Q15", 0, 0.133, 0.642, 1, NA_real_,NA_real_,
  "Q16", 0, 0.200, 0.758, 1, NA_real_, NA_real_,
  "Q17", 0, 0.072, 0.338, 0.752, 1, NA_real_,
  "Q18", 0, 0.033, 0.223, 0.621, 0.843, 1,
  "Q19", 0, 0.024, 0.205, 0.586, 0.826, 1,
  "Q20", 0, 0.187, 0.695, 1, NA_real_,NA_real_
) %>% ready4fun::write_and_doc_ds(db_1L_chr = "aqol6d_adult_disv_lup_tb",
                                  title_1L_chr = "AQoL6D (adult version) item disvalues lookup table",
                                  desc_1L_chr = "Disutility weights for individual AQoL6D (adult version) items.",
                                  url_1L_chr = "https://www.aqol.com.au/index.php/scoring-algorithms",
                                  abbreviations_lup = abbreviations_lup,
                                  pkg_dss_tb = pkg_dss_tb)
pkg_dss_tb <- tibble::tibble(Question_dbl = 1:20,
                             Domain_chr = c(rep("IL",4),
                                            rep("REL",3),
                                            rep("MH",4),
                                            rep("COP",3),
                                            rep("P",3),
                                            rep("SEN",3))) %>%
  ready4fun::write_and_doc_ds(db_1L_chr = "aqol6d_domain_qs_lup_tb",
                              title_1L_chr = "AQoL6D dimension questions lookup table",
                              desc_1L_chr = "Breakdown of which questions relate to which dimension of the AQoL6D.",
                              url_1L_chr = "https://www.aqol.com.au/index.php/scoring-algorithms",
                              abbreviations_lup = abbreviations_lup,
                              pkg_dss_tb = pkg_dss_tb)
pkg_dss_tb <- tibble::tribble(
  ~Dimension_chr, ~Constant_dbl,
  "IL",-0.978,
  "RL", -0.923,
  "MH", -0.983,
  "COP", -0.930,
  "P", -0.96,
  "SEN", -0.851) %>% ready4fun::write_and_doc_ds(db_1L_chr = "aqol6d_dim_sclg_con_lup_tb",
                                                 title_1L_chr = "AQoL6D dimension scaling constants lookup table",
                                                 desc_1L_chr = "Scaling constants for each dimension of AQoL6D.",
                                                 url_1L_chr = "https://www.aqol.com.au/index.php/scoring-algorithms",
                                                 abbreviations_lup = abbreviations_lup,
                                                 pkg_dss_tb = pkg_dss_tb)

pkg_dss_tb <- tibble::tribble(
  ~Question_chr, ~Worst_Weight_dbl,
  "Q1", 0.385412,
  "Q2", 0.593819,
  "Q3", 0.630323,
  "Q4", 0.794888,
  "Q5", 0.64303,
  "Q6", 0.697742,
  "Q7", 0.508658,
  "Q8", 0.640377,
  "Q9", 0.588422,
  "Q10", 0.648748,
  "Q11", 0.71122,
  "Q12", 0.415694,
  "Q13", 0.636994,
  "Q14", 0.773296,
  "Q15", 0.631833,
  "Q16", 0.767573,
  "Q17", 0.652241,
  "Q18", 0.580696,
  "Q19", 0.463022,
  "Q20", 0.604613
) %>% ready4fun::write_and_doc_ds(db_1L_chr = "aqol6d_adult_itm_wrst_wghts_lup_tb",
                                  title_1L_chr = "AQoL6D (adult) item worst weightings lookup table",
                                  desc_1L_chr = "Worst weightings for individual items in AQoL6D (adult version).",
                                  url_1L_chr = "https://www.aqol.com.au/index.php/scoring-algorithms",
                                  abbreviations_lup = abbreviations_lup,
                                  pkg_dss_tb = pkg_dss_tb)
pkg_dss_tb <- read.csv("data-raw/csvs/AQoL_6D_Dim_Scaling.csv", stringsAsFactors = F, fileEncoding="UTF-8-BOM") %>%
  ready4fun::write_and_doc_ds(db_1L_chr = "adol_dim_scalg_eqs_lup",
                              title_1L_chr = "AQoL6D (adolescent) item worst weightings equations lookup table",
                              desc_1L_chr = "Dimension scaling equations for adolescent version of AQoL6D scoring algorithm.",
                              url_1L_chr = "https://www.aqol.com.au/index.php/scoring-algorithms",
                              abbreviations_lup = abbreviations_lup,
                              pkg_dss_tb = pkg_dss_tb)
pkg_dss_tb <- read.csv("data-raw/csvs/aqol_valid_stata.csv") %>%
  ready4fun::write_and_doc_ds(db_1L_chr = "aqol6d_adult_vldn_pop_with_STATA_scores_tb",
                              title_1L_chr = "STATA comparison validation synthetic population",
                              desc_1L_chr = "Synthetic population following application of STATA adult scoring algorithm.",
                              url_1L_chr = "https://www.aqol.com.au/index.php/scoring-algorithms",
                              abbreviations_lup = abbreviations_lup,
                              pkg_dss_tb = pkg_dss_tb)
replication_popl_tb <- read.csv("data-raw/csvs/fake_pop_tb.csv") %>%
  dplyr::mutate(c_sofas = as.integer(round(c_sofas,0))) %>%
  # ready4use::ready4_dv_import_lup() %>%
  # tibble::add_case(data_repo_db_ui = "https://doi.org/10.7910/DVN/GRZRY5",
  #                  file_name = "fake_pop_tb",
  #                  file_type = ".csv",
  #                  data_repo_file_ext = ".tab") %>%
  # ready4use::get_data() %>%
  transform_raw_aqol_tb_to_aqol6d_tb()
scored_data_tb <- add_adol6d_scores(replication_popl_tb,
                                    prefix_1L_chr =  "aqol6d_q",
                                    id_var_nm_1L_chr = "fkClientID",
                                    wtd_aqol_var_nm_1L_chr = "aqol6d_total_w") %>%
  dplyr::select(-match_var_chr)
dictionary_tb <- ready4use::make_pt_ready4_dictionary(var_nm_chr = names(scored_data_tb),
                                                      var_cat_chr = c("Identifier", "Clinical","Service","Clinical",
                                                                      rep("Demographic",11),
                                                                      rep("Clinical",6),
                                                                      rep("Utility Questionaire Response",20),
                                                                      "Functioning",
                                                                      "Temporal",
                                                                      rep("Demographic",3),
                                                                      rep("Utility Item Disvalue",20),
                                                                      rep("Utility Dimension Disvalue",6),
                                                                      rep("Utility Dimension Score (Adult)",6),
                                                                      "Utility Overall Score (Disvalue Scale)",
                                                                      "Utility Overall Score (Life-Death Scale)",
                                                                      rep("Utility Overall Score (Adolescent Disutility Scale)",2), # Includes Testing Duplicate
                                                                      "Utility Overall Score (Instrument)",
                                                                      "Utility Overall Score (Instrument - Rotated)",
                                                                      "Utility Overall Score (Final Weighted)"
                                                      ),
                                                      var_desc_chr = c("Unique Client Identifier",
                                                                       "Primary Diagnosis",
                                                                       "Centre Name",
                                                                       "Clinical Stage",
                                                                       "Age",
                                                                       "Age Group",
                                                                       "Gender",
                                                                       "Sex at Birth",
                                                                       "Sexual Orientation",
                                                                       "Country Of Birth",
                                                                       "Aboriginal or Torres Strait Islander",
                                                                       "Speaks English At Home",
                                                                       "Native English Speaker",
                                                                       "Relationship Status",
                                                                       "Education and Employment Status",
                                                                       "Kessler Psychological Distress Scale (6 Dimension)",
                                                                       "Patient Health Questionnaire",
                                                                       "Behavioural Activation for Depression Scale",
                                                                       "Generalised Anxiety Disorder Scale",
                                                                       "Overall Anxiety Severity and Impairment Scale",
                                                                       "Screen for Child Anxiety Related Disorders",
                                                                       paste0("Assessment of Quality of Life (6 Dimension) Question ",1:20),
                                                                       "Social and Occupational Functioning Assessment Scale",
                                                                       "Round of Data Collection",
                                                                       "Gender (Grouped)",
                                                                       "Region of Residence (Metropolitan or Regional)",
                                                                       "Culturally And Linguistically Diverse",
                                                                       paste0("Assessment of Quality of Life (6 Dimension) Item Disvalue",1:20),
                                                                       lapply(scored_data_tb, Hmisc::label) %>% purrr::flatten_chr() %>% purrr::keep(c(rep(F,66),rep(T,19)))
                                                      ),
                                                      var_type_chr = names(scored_data_tb) %>% purrr::map_chr(~{
                                                        class_chr <- class(scored_data_tb %>% dplyr::pull(.x))
                                                        class_chr[class_chr!="labelled"][1]
                                                      })) %>% ready4use::ready4_dictionary()
Hmisc::label(dictionary_tb) = as.list(c("Variable","Category", "Description", "Class"))
dictionary_tb <- dictionary_tb %>%
  dplyr::arrange(var_cat_chr,var_nm_chr)
pkg_dss_tb <- dictionary_tb %>%
  dplyr::filter(var_nm_chr %in% names(replication_popl_tb)) %>%
  ready4fun::write_and_doc_ds(db_1L_chr = "repln_ds_dict_r3",
                              title_1L_chr = "Data dictionary for study population dataset",
                              desc_1L_chr = "A data dictionary of the variables used in the source and replication (synthetic) datasets for the First Bounce transfer to utility study",
                              abbreviations_lup = abbreviations_lup,
                              pkg_dss_tb = pkg_dss_tb)
pkg_dss_tb <- dictionary_tb %>%
  dplyr::filter((!var_nm_chr %in% names(replication_popl_tb)) | startsWith(var_nm_chr, "aqol")) %>%
  ready4fun::write_and_doc_ds(db_1L_chr = "aqol_scrg_dict_r3",
                              title_1L_chr = "Data dictionary for AQoL scoring",
                              desc_1L_chr = "A data dictionary of the variables used in scoring AQoL 6D utility questionnaire responses.",
                              abbreviations_lup = abbreviations_lup,
                              pkg_dss_tb = pkg_dss_tb)
pkg_dss_tb <- replication_popl_tb %>%
  #add_labels_from_dictionary(dictionary_tb = dictionary_tb) %>%
  ready4fun::write_and_doc_ds(db_1L_chr = "replication_popl_tb",
                              title_1L_chr = "Synthetic population replication dataset",
                              desc_1L_chr = "A purely synthetic dataset, representative of the original study data, that can be used for replication runs of package algorithms.",
                              abbreviations_lup = tibble::tibble(short_name_chr = dictionary_tb$var_nm_chr,
                                                                 long_name_chr = dictionary_tb$var_desc_chr,
                                                                 plural_lgl = F),
                              simple_lup_1L_lgl = T,#
                              pkg_dss_tb = pkg_dss_tb)
##
# 7. Save copy of package documentation to online data repo.
# ds_ls <- ready4use::write_pkg_dss_to_dv_ds_csvs(pkg_dss_tb,
#                                                 dv_nm_1L_chr = "ready4models",
#                                                 ds_url_1L_chr = "https://doi.org/10.7910/DVN/RXGPAT",
#                                                 parent_dv_dir_1L_chr = "../../../../../Data/Dataverse",
#                                                 wait_time_in_secs_int = 5L)
# NOTE: NEED TO UPDATE DIR PATH FOR MODELS
## Note files to be rewritten cannot be open in RStudio.
## 8. Document functions.
usethis::use_build_ignore("initial_setup.R")
readLines(".github/workflows/R-CMD-check.yaml")[-28] %>%
  writeLines(".github/workflows/R-CMD-check.yaml")
usethis::use_package("ggfortify")
usethis::use_package("knitrBootstrap")
usethis::use_dev_package("ready4show")
usethis::use_dev_package("ready4use")
#usethis::use_package("knitr", type = "suggests")
#usethis::use_package("rgl")
#
ready4fun::write_and_doc_fn_fls(fns_dmt_tb,
                                r_dir_1L_chr = "R",
                                dev_pkgs_chr = c("ready4fun","ready4class","ready4use","ready4show","dataverse"),
                                update_pkgdown_1L_lgl = T)
##
## PART FOUR
# devtools::build_vignettes()
##
## Add, Commit and Push

