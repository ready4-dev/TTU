---
title: "Implement A Utility Mapping Study (Adolescent AQoL-6D Example)"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Implement A Utility Mapping Study (Adolescent AQoL-6D Example)}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

Note: **This vignette uses fake data** - it is for illustrative purposes only and should not be used to inform decision making.

## Motivation

Youth mental health services do not typically collect health utility data from their clients, which makes it more difficult to place an economic values on outcomes attained in these services. One strategy for addressing this gap is to use data from similar samples of young people that contain both health utility and the types of outcome measures that are collected in clinical services. The TTU package provides a toolkit for conducting and reporting a utility mapping (or Transfer to Utility) study.

## Implementation

TTU has been developed using the [ready4 framework](https://ready4-dev.github.io/ready4/) and combines and extends multiple types of [modules](https://ready4-dev.github.io/ready4/articles/V_01.html) from the readyforwhatsnext model:

- Modules for labeling, validating and summarising youth mental health datasets from the [youthvars](https://ready4-dev.github.io/youthvars/) package;
- Modules for scoring health utility from the [scorz](https://ready4-dev.github.io/scorz/) package;
- Modules for specifying and testing statistical models from the [specific](https://ready4-dev.github.io/specific/) package;
- Modules for generating reports from the [ready4show](https://ready4-dev.github.io/ready4show/)  package; and
- Modules for sharing data via online data repositories from the [ready4use](https://ready4-dev.github.io/ready4use/)  package.

Additionally, TTU relies on two RMarkdown programs:

- ttu_mdl_ctlg: Generate a Template Utility Mapping (Transfer to Utility) Model Catalogue (https://doi.org/10.5281/zenodo.5936870)
- ttu_lng_ss: Create a Draft Scientific Manuscript For A Utility Mapping Study (https://doi.org/10.5281/zenodo.5976987)


## Workflow
### Background and citation 
The following workflow illustrates (**using fake data**) the same steps we used in a real world study, a summary of which is available at https://doi.org/10.1101/2021.07.07.21260129). Citation information for that study is:

@article {Hamilton2021.07.07.21260129,
	author = {Hamilton, Matthew P and Gao, Caroline X and Filia, Kate M and Menssink, Jana M and Sharmin, Sonia and Telford, Nic and Herrman, Helen and Hickie, Ian B and Mihalopoulos, Cathrine and Rickwood, Debra J and McGorry, Patrick D and Cotton, Sue M},
	title = {Predicting Quality Adjusted Life Years in young people attending primary mental health services},
	elocation-id = {2021.07.07.21260129},
	year = {2021},
	doi = {10.1101/2021.07.07.21260129},
	publisher = {Cold Spring Harbor Laboratory Press},
	URL = {https://www.medrxiv.org/content/early/2021/07/12/2021.07.07.21260129},
	eprint = {https://www.medrxiv.org/content/early/2021/07/12/2021.07.07.21260129.full.pdf},
	journal = {medRxiv}
}

The program applied in that study, which this workflow closely resembles is available at https://doi.org/10.5281/zenodo.6116077 and can be cited as follows:

@software{hamilton_matthew_2022_6212704,
  author       = {Hamilton, Matthew and
                  Gao, Caroline},
  title        = {{Complete study program to reproduce all steps from 
                   data ingest through to results dissemination for a
                   study to map mental health measures to AQoL-6D
                   health utility}},
  month        = feb,
  year         = 2022,
  note         = {{Matthew Hamilton and Caroline Gao  (2022). 
                   Complete study program to reproduce all steps from
                   data ingest through to results dissemination for a
                   study to map mental health measures to AQoL-6D
                   health utility. Zenodo.
                   https://doi.org/10.5281/zenodo.6116077. Version
                   0.0.9.3}},
  publisher    = {Zenodo},
  version      = {0.0.9.3},
  doi          = {10.5281/zenodo.6212704},
  url          = {https://doi.org/10.5281/zenodo.6212704}
}

### Load required packages
We begin by loading our required packages.

```{r message=FALSE, warning=FALSE}
library(ready4)
library(ready4use)
library(youthvars)
library(scorz)
library(TTU)
```

### Add dataset metadata 
We use the Ready4useDyad and Ready4useRepos modules to [retrieve and ingest](https://ready4-dev.github.io/ready4use/articles/V_01.html) and to then [pair a dataset and its data dictionary](_https://ready4-dev.github.io/ready4use/articles/V_02.html). 

```{r}
A <- Ready4useDyad(ds_tb = Ready4useRepos(dv_nm_1L_chr = "fakes",
                                          dv_ds_nm_1L_chr = "https://doi.org/10.7910/DVN/HJXYKQ",
                                          dv_server_1L_chr = "dataverse.harvard.edu") %>%
                     ingest(fls_to_ingest_chr = c("ymh_clinical_tb"),
                            metadata_1L_lgl = F) %>%
                     youthvars::transform_raw_ds_for_analysis(),
                   dictionary_r3 = Ready4useRepos(dv_nm_1L_chr = "TTU", 
                                                  dv_ds_nm_1L_chr = "https://doi.org/10.7910/DVN/DKDIB0", 
                                                  dv_server_1L_chr = "dataverse.harvard.edu") %>%
                     ingest(fls_to_ingest_chr = c("dictionary_r3"),
                            metadata_1L_lgl = F)) %>%
  renew(type_1L_chr = "label")
```

We use the YouthvarsSeries module to [supply metadata about out a longitudinal dataset vignette](https://ready4-dev.github.io/youthvars/articles/V_02.html).

```{r}
A <- YouthvarsSeries(a_Ready4useDyad = A,
                     id_var_nm_1L_chr = "fkClientID",
                     timepoint_var_nm_1L_chr = "round",
                     timepoint_vals_chr = levels(procureSlot(A,
                                                             "ds_tb")$round))
```

### Score health utility 

We next use the ScorzAqol6Adol module to [score adolescent AQoL-6D health utility](https://ready4-dev.github.io/scorz/articles/V_01.html).

```{r}
A <- TTUProject(a_ScorzProfile = ScorzAqol6Adol(a_YouthvarsProfile = A))
A <- renewSlot(A, "a_ScorzProfile")
```

### Evaluate candidate models 

Over the next few steps we will use modules from the specific package to  to [specify and assess a number of candidate utility mapping models](https://ready4-dev.github.io/specific/articles/V_01.html).

```{r echo=FALSE}
# Make next bit into renew method
```
```{r}
A <- renewSlot(A, "b_SpecificParameters", SpecificConverter(a_ScorzProfile = A@a_ScorzProfile) %>%
                 metamorphose() %>%
                 procureSlot("b_SpecificParameters"))
```

```{r}
A <- renewSlot(A, "b_SpecificParameters@predictors_lup", Ready4useRepos(dv_nm_1L_chr = "TTU", 
                                                                        dv_ds_nm_1L_chr = "https://doi.org/10.7910/DVN/DKDIB0", 
                                                                        dv_server_1L_chr = "dataverse.harvard.edu") %>%
                 ingest(fls_to_ingest_chr = c("predictors_r3"),
                        metadata_1L_lgl = F)) 
```

We can inspect the metadata on candidate predictors that we have just ingested.

```{r}
exhibitSlot(A, "b_SpecificParameters@predictors_lup")
```

We add additional metadata about variables in our dataset that will be used in exploratory modelling.

```{r}
A <- renewSlot(A, "b_SpecificParameters@depnt_var_min_max_dbl", c(0.03,1)) %>% # Inherit From TTUAqolAdol
  renewSlot("b_SpecificParameters@candidate_predrs_chr", c("BADS","GAD7", "K6", "OASIS", "PHQ9", "SCARED")) %>%
  renewSlot("b_SpecificParameters@candidate_covars_chr", c("d_sex_birth_s", "d_age",  "d_sexual_ori_s", 
                                                           "d_studying_working", "c_p_diag_s", "c_clinical_staging_s",
                                                           "SOFAS")) %>%
  renewSlot("b_SpecificParameters@descv_var_nms_chr", c("d_age","Gender","d_relation_s", "d_sexual_ori_s", 
                                                        "Region", "d_studying_working", "c_p_diag_s", 
                                                        "c_clinical_staging_s","SOFAS")) %>%
  renewSlot("b_SpecificParameters@msrmnt_date_var_nm_1L_chr", "d_interview_date") 
```
```{r}
A <-  renewSlot(A, "b_SpecificParameters@fake_1L_lgl", T) 
```
```{r}
A <- renewSlot(A, "c_SpecificProject", SpecificModels(a_YouthvarsProfile = A@a_ScorzProfile@a_YouthvarsProfile,
                                                      b_SpecificParameters = A@b_SpecificParameters,
                                                      paths_chr = tempdir())) 
```

```{r}
A <- ratifySlot(A, "c_SpecificProject")
```

```{r}
A <- renewSlot(A, "c_SpecificProject", 
               authorSlot(A, "c_SpecificProject", what_1L_chr = "workspace"))
```

We now generate tables and charts that describe our dataset. These are saved in a sub-directory of our output data directory, a copy of which is [available for download](https://github.com/ready4-dev/TTU/releases/download/Documentation_0.0/_A_Candidate_Mdls_Cmprsn_Descriptives.zip). One of the plots is also reproduced here.

```{r message=FALSE, results='hide', warning=FALSE}
A <- renewSlot(A, "c_SpecificProject",
               authorSlot(A, "c_SpecificProject", what_1L_chr = "descriptives",
                          digits_1L_int = 3L))
```

We next compare the performance of different model types. This step saves model objects and plots to a sub-directory of our output directory, a copy of which is [available for download](https://github.com/ready4-dev/TTU/releases/download/Documentation_0.0/B_Candidate_Predrs_Cmprsn.zip).

```{r message=FALSE, results='hide', warning=FALSE}
A <- renewSlot(A, "c_SpecificProject",
               investigateSlot(A, "c_SpecificProject",
                               depnt_var_max_val_1L_dbl = 0.99,
                               session_ls = sessionInfo()))
```

After inspecting the output of the previous command, we can now specify the preferred model types to use from this point onwards.

```{r message=FALSE, results='hide', warning=FALSE}
A <- renewSlot(A, "c_SpecificProject",
               renew(procureSlot(A, "c_SpecificProject"),
                     new_val_xx = c("GLM_GSN_LOG", "OLS_CLL"),
                     type_1L_chr = "results",
                     what_1L_chr = "prefd_mdls"))
```

Next we assess multiple versions of our preferred model type - one single predictor model for each of our candidate predictors and the same models with candidate covariates added. A number of model/plot objects saved to a sub-directory of our output directory, a copy of which is [available for download](https://github.com/ready4-dev/TTU/releases/download/Documentation_0.0/C_Predrs_Sngl_Mdl_Cmprsn.zip).

```{r message=FALSE, results='hide', warning=FALSE}
A <- renewSlot(A, "c_SpecificProject",
               investigateSlot(A,"c_SpecificProject"))
```

After reviewing the output of the previous step, we specify the covariates we wish to add to the models.

```{r message=FALSE, results='hide', warning=FALSE}
A <- renewSlot(A, "c_SpecificProject",
               renew(procureSlot(A, "c_SpecificProject"),
                     new_val_xx = "SOFAS",
                     type_1L_chr = "results",
                     what_1L_chr = "prefd_covars"))
```

We now assess the multivariate models.  More model/plot objects are saved to a sub-directory of our output directory, a copy of which is [available for download](https://github.com/ready4-dev/TTU/releases/download/Documentation_0.0/E_Predrs_W_Covars_Sngl_Mdl_Cmprsn.zip).

```{r message=FALSE, results='hide', warning=FALSE}
A <- renewSlot(A, "c_SpecificProject",
               investigateSlot(A, "c_SpecificProject"))
```

We next reformulate the models we finalised in the previous step so that they are suitable for modelling longitudinal change.

For our primary analysis, we use the longitudinal formulation of the models we previously selected. A series of large model files are written to the local output data directory.

```{r eval =F}
A <- renewSlot(A, "c_SpecificProject",
               investigateSlot(A, "c_SpecificProject"))
```

For our secondary analyses, we specify alternative combinations of predictors and covariates.

```{r eval =F}
A <- renewSlot(A, "c_SpecificProject",
               investigateSlot(A, "c_SpecificProject",
                               scndry_anlys_params_ls = make_scndry_anlys_params(candidate_predrs_chr = c("SOFAS"),
                                                                                 candidate_covar_nms_chr = c("d_sex_birth_s", 
                                                                                                             "d_age", 
                                                                                                             "d_sexual_ori_s",
                                                                                                             "d_studying_working"),
                                                                                 prefd_covars_chr = NA_character_) %>%
                                 make_scndry_anlys_params(candidate_predrs_chr = c("SCARED","OASIS","GAD7"),
                                                          candidate_covar_nms_chr = c("PHQ9", "SOFAS", 
                                                                                      "d_sex_birth_s", 
                                                                                      "d_age", 
                                                                                      "d_sexual_ori_s",
                                                                                      "d_studying_working"),
                                                          prefd_covars_chr = "PHQ9")))
```

### Report and disseminate findings

#### Create shareable models
The model objects created and saved in our working directory by the preceding steps are not suitable for public dissemination. They are both too large in file size and, more importantly, include copies of our source dataset. We can overcome these limitations by creating shareable versions of the models. Two types of shareable version are created - copies of the original model objects in which fake data overwrites the original source data and summary tables of model coefficients.

```{r eval =F}
A <- renewSlot(A, "c_SpecificProject",
               authorData(procureSlot(A, "c_SpecificProject")))
```

#### Specify study reporting metadata
We create a `TTUSynopsis` object that contains the fields necessary to render and share reports.

```{r eval =F}
A <- renewSlot(A, "d_TTUReports",
               {
                 Y <- metamorphoseSlot(A, "c_SpecificProject")
                 Y <- TTUSynopsis(a_Ready4showPaths = Y@a_Ready4showPaths,
                                  b_SpecificResults = Y@b_SpecificResults,
                                  c_SpecificParameters = Y@c_SpecificParameters,
                                  d_YouthvarsProfile = Y@d_YouthvarsProfile,
                                  rmd_fl_nms_ls = Y@rmd_fl_nms_ls)
                 Y <- TTUReports(a_TTUSynopsis = Y)
                 Y
                 }
               )
```

We add metadata relevant to the reports that we will be generating to these fields. Note that the data we supply to the Ready4useRepos object below must relate to a repository to which we have write permissions (otherwise subsequent steps will fail).

```{r eval =F}
A <- renewSlot(A, "d_TTUReports@a_TTUSynopsis",
               procureSlot(A, "d_TTUReports@a_TTUSynopsis") %>% 
                 renewSlot("authors_r3", ready4show::authors_tb) %>%
                 renewSlot("institutes_r3", ready4show::institutes_tb) %>%
                 renewSlot("digits_int", c(3L,3L)) %>%
                 renewSlot("outp_formats_chr", c("PDF","PDF")) %>%
                 renewSlot("title_1L_chr", "A hypothetical utility mapping study using fake data") %>%
                 renewSlot("correspondences_r3", old_nms_chr = c("PHQ9", "GAD7"), new_nms_chr = c("PHQ-9", "GAD-7")) %>%
                 renewSlot("e_Ready4useRepos", Ready4useRepos(dv_nm_1L_chr = "fakes", 
                                                              dv_ds_nm_1L_chr = "https://doi.org/10.7910/DVN/D74QMP", 
                                                              dv_server_1L_chr = "dataverse.harvard.edu"))) 

```

```{r echo = F, eval =F}
## Describe and share models
# We now create a `TTUReports` object, that we can use to efficiently retrieve and apply programs that can summarise our study results.
# C <- TTUReports(a_TTUSynopsis = B)
```

#### Author model catalogues
We download a program for generating a catalogue of models and use it to summarising the models created under each study analysis (one primary and two secondary). The catalogues are saved locally.

```{r eval =F}
authorSlot(A, "d_TTUReports", what_1L_chr = "Catalogue", download_tmpl_1L_lgl = T)
```

#### Share model catalogue
We share the catalogues that we created, uploading a copy to our study online repository. To run this step you will need write permissions to the online repository.

```{r eval =F}
shareSlot(A, "d_TTUReports@a_TTUSynopsis", type_1L_chr = "Report", what_1L_chr = "Catalogue") 
```

#### Share models
We share tables of coefficients and other meta-data about the models we have created by posting them to the online repository. The object we create and share is designed to be used in conjunction with the `youthu` package to make it easier to make predictions with these models using new data. Again, you will need write permissions to the online repository.

```{r eval =F}
shareSlot(A, "d_TTUReports@a_TTUSynopsis", type_1L_chr = "Models", what_1L_chr = "ingredients")
```

#### Author manuscript
We add some content about the manuscript we wish to author.

```{r eval =F}
A <- renewSlot(A, "d_TTUReports@a_TTUSynopsis",
               procureSlot(A, "d_TTUReports@a_TTUSynopsis") %>% 
                 renewSlot("background_1L_chr", "Quality Adjusted Life Years (QALYs) are often used in economic evaluations, yet utility weights for deriving them are rarely directly measured in mental health services.") %>%
                 renewSlot("coi_1L_chr", "None declared") %>%
                 renewSlot("conclusion_1L_chr","Nothing should be concluded from this study as it is purely hypothetical.") %>%
                 renewSlot("ethics_1L_chr", "The study was reviewed and granted approval by no-one." ) %>%
                 renewSlot("funding_1L_chr", "The study was funded by no-one.") %>%
                 renewSlot("interval_chr", "three months") %>%
                 renewSlot("keywords_chr", c("anxiety", "AQoL","depression", "psychological distress", "QALYs", "utility mapping")) %>%
                 renewSlot("sample_desc_1L_chr", "The study sample is fake data.") )
```

We create a summary of results that can be interpreted by the program that authors the manuscript.

```{r eval =F}
A <- renewSlot(A, "d_TTUReports@a_TTUSynopsis@abstract_args_ls",
               manufactureSlot(A,"d_TTUReports@a_TTUSynopsis", what_1L_chr = "abstract_args_ls",
                               depnt_var_nms_chr = c("AQoL-6D", "Adolescent AQoL Six Dimension"))) 
```

```{r eval =F}
A <- enhanceSlot(A, "d_TTUReports@a_TTUSynopsis", with_1L_chr = "results_ls",
                 depnt_var_nms_chr = c("AQoL-6D", "Adolescent AQoL Six Dimension")) 
```

We create and save the plots that will be used in the manuscript.

```{r eval =F}
authorSlot(A, "d_TTUReports", type_1L_chr = "Plots",
           depnt_var_desc_1L_chr = A@d_TTUReports@a_TTUSynopsis@b_SpecificResults@a_SpecificShareable@shareable_outp_ls$results_ls$study_descs_ls$health_utl_nm_1L_chr)
```

We download a program for generating a template manuscript and run it to author a first draft of the manuscript.

```{r eval =F}
authorSlot(A, "d_TTUReports", type_1L_chr = "Report", what_1L_chr = "Manuscript_Auto", download_tmpl_1L_lgl = T)
```

We can copy the RMarkdown files that created the template manuscript to a new director (which we call "Manuscript_Submission") so that we can then manually edit those files to produce a manuscript that we can submit for publication. Note that in this example we have not made any edits to the template manuscript.

```{r eval =F}
R.utils::copyDirectory(paste0(A@d_TTUReports@a_TTUSynopsis@a_Ready4showPaths@outp_data_dir_1L_chr,
                              "/",
                              A@d_TTUReports@a_TTUSynopsis@a_Ready4showPaths@mkdn_data_dir_1L_chr,
                              "/Manuscript_Auto"),
                       paste0(A@d_TTUReports@a_TTUSynopsis@a_Ready4showPaths@outp_data_dir_1L_chr,
                              "/",
                              A@d_TTUReports@a_TTUSynopsis@a_Ready4showPaths@mkdn_data_dir_1L_chr,
                              "/Manuscript_Submission"))
```


```{r echo=FALSE, eval=FALSE}
# We create the files we will be using for figures submitted to our target journal and also a table of all the dependency packages used in our analysis and reporting.
# authorSlot(A, "d_TTUReports", type_1L_chr = "Plots", what_1L_chr = "Manuscript_Submission",
#            depnt_var_desc_1L_chr = "AQoL-6D" # Inherit from TTUAqolAdol
#            #,timepoint_new_nms_chr = c("Baseline","Follow-up")
#        ) # Not required for vignette
# author(A@d_TTUReports, type_1L_chr = "Dependencies", what_1L_chr = "Manuscript_Submission") #ERROR - Not required for vignette
```

Once any edits to the RMarkdown files for creating the submission manuscript have been finalised, we can run the following command to author the manuscript. The below commands will generate a Microsoft Word format manuscript and a PDF technical appendix. Unlike the template manuscript, the figures and tables are positioned after (and not within) the main body of the manuscript. Note that the Word version of the manuscript generated by these commands will require some minor formatting edits (principally to the display of tables and numbering of sections).

```{r eval =F}
A <- renewSlot(A, "d_TTUReports",
               procureSlot(A, "d_TTUReports") %>%
                 renewSlot("a_TTUSynopsis@tables_in_body_lgl",  F) %>%
                 renewSlot("a_TTUSynopsis@figures_in_body_lgl", F) %>%
                 renewSlot("a_TTUSynopsis@outp_formats_chr", c("Word","PDF")))
authorSlot(A, "d_TTUReports", what_1L_chr = "Manuscript_Submission", download_tmpl_1L_lgl = F)
```

```{r echo=FALSE, eval=FALSE}
# UPLOAD MS
purrr::walk2(c("Manuscript_Auto","Manuscript_Submission"),
             2:1,
             ~ {
               x <- A@d_TTUReports@a_TTUSynopsis
               what_1L_chr <- .x
               idx_1L_int <- .y
               if(what_1L_chr %in% c("Manuscript_Auto","Manuscript_Submission")){ # ADD THIS TO share_SpecificSynopsis
                 ms_nm_1L_chr <- "Manuscript"
                 idx_1L_int <- ready4::write_fls_to_dv(paste0(x@a_Ready4showPaths@outp_data_dir_1L_chr,
                                                              "/",
                                                              x@a_Ready4showPaths@reports_dir_1L_chr,
                                                              "/",
                                                              what_1L_chr,
                                                              "/",
                                                              ms_nm_1L_chr,
                                                              ifelse(x@outp_formats_chr[idx_1L_int] == "Word",
                                                                     ".docx",
                                                                     paste0(".",tolower(x@outp_formats_chr[idx_1L_int])))),
                                                       descriptions_chr = paste0("Scientific summary of utility mapping study",
                                                                                 ifelse(what_1L_chr == "Manuscript_Auto", " (algorithm generated)","")),
                                                       ds_url_1L_chr = x@e_Ready4useRepos@dv_ds_nm_1L_chr)
                 
                 
               }
               Sys.sleep(5L)
               }
               )

```
```{r echo=F, eval=F}
outp_dirs_chr <- list.dirs(paste0(A@d_TTUReports@a_TTUSynopsis@a_Ready4showPaths@outp_data_dir_1L_chr,"/Output"))
outp_dirs_chr[2:7] %>%
  purrr::walk(~{
    dir_path_1L_chr <- .x
    file_paths_chr <- dir(dir_path_1L_chr, full.names = T)
    if(!identical(file_paths_chr, character(0))){
          zip(zipfile = dir_path_1L_chr, files = file_paths_chr)
    ready4::write_fls_to_repo(paste0(dir_path_1L_chr,".zip"),
                              piggyback_to_1L_chr = "ready4-dev/TTU")
    Sys.sleep(5L)
    }

  })

```


```{r echo=FALSE, eval=FALSE}
# We now generate the Supplementary Information for the submission manuscript.
authorReport(procureSlot(A, "d_TTUReports")  %>%
               renewSlot("a_TTUSynopsis@rmd_fl_nms_ls", ready4show::make_rmd_fl_nms_ls(pdf_fl_nm_1L_chr = "TA_PDF")) %>%
               renewSlot("a_TTUSynopsis@outp_formats_chr", c("PDF","PDF"))%>%
               procureSlot("a_TTUSynopsis"),
               fl_nm_1L_chr = "Supplement",
               #download_tmpl_1L_lgl = F,
               what_1L_chr = "Manuscript_Submission") 

```

### Tidy workspace
The preceding steps saved multiple objects (mostly R model objects) that have embedded within them copies of the source dataset. We can now purge all such copies from our output data directory.

```{r eval = F}
author(procureSlot(A,"c_SpecificProject"),
       type_1L_chr = "purge_write") 
```

```{r echo=FALSE, eval=FALSE}
# transform_dyad_for_analysis <- function(data_Ready4useDyad){
#   data_Ready4useDyad@ds_tb <- data_Ready4useDyad@ds_tb %>%
#             youthvars::transform_raw_ds_for_analysis()
#   data_Ready4useDyad@dictionary_r3 <- data_Ready4useDyad@dictionary_r3 %>%
#     dplyr::mutate(var_nm_chr = dplyr::case_when(var_nm_chr == "phq9_total" ~  "PHQ9",
#                                                 var_nm_chr == "bads_total" ~ "BADS",
#                                                 var_nm_chr == "gad7_total" ~ "GAD7",
#                                                 var_nm_chr == "oasis_total" ~ "OASIS",
#                                                 var_nm_chr == "scared_total" ~ "SCARED",
#                                                 var_nm_chr == "k6_total" ~ "K6",
#                                                 var_nm_chr == "sofas_total" ~ "SOFAS",
#                                                 T ~ var_nm_chr %>% purrr::map_chr(~.x)
#                                                 ))
#   return(data_Ready4useDyad)
# }
```
