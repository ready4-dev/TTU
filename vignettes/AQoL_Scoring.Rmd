---
title: "AQoL_Scoring"
author: "Caroline Gao and Matthew Hamilton"
date: "13/08/2020"
output: 
  knitrBootstrap::bootstrap_document:
     theme: journal
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(magrittr)
library(FBaqol)
# devtools::load_all()
```

# Scoring algorithm validation

The below table compares the utility scores generated by the AQoL 6D adult population scoring algorithm implemented in the Stata file downloaded from the AQoL website (https://www.aqol.com.au/index.php/scoring-algorithms) with that generated by the translation of that algorithm implemented by FBaqol.

```{r}
# aqol6d_valid_tb <- readRDS("Data cleaning/Data/Combined_cleaned_V2.rds") %>%
#   dplyr::select(dplyr::starts_with("aqol6d_q")) %>%
#   dplyr::rename_all(~stringr::str_replace(.x,"6d_q",""))
# write.csv(aqol6d_valid_tb,"Data/aqol_validation.csv")
# Apply Stata to this file
#data("aqol6d_adult_vldn_pop_with_STATA_scores_tb", package = "FBaqol")
aqol_tb <- FBaqol::aqol6d_adult_vldn_pop_with_STATA_scores_tb# %>% 
  # dplyr::select(dplyr::starts_with("aqol"),                                                        dplyr::starts_with("uaqol")) %>%
#  dplyr::rename_all(~stringr::str_replace(.x,"aqol","aqol6d_q")) 
comparison_tb <- aqol_tb %>%
  dplyr::mutate(uaqol_FB = FBaqol::calculate_aqol6dU_dbl(aqol6d_items_tb = aqol_tb,
                             prefix_1L_chr =  "aqol",
                             aqol6d_from_8d_coeffs_lup_tb = FBaqol::aqol6d_from_8d_coeffs_lup_tb,
                             dim_sclg_constant_lup_tb = FBaqol::dim_sclg_constant_lup_tb,
                             disvalues_lup_tb = FBaqol::disvalues_lup_tb,
                             itm_wrst_wghts_lup_tb = FBaqol::itm_wrst_wghts_lup_tb),
                uaqol_adol = FBaqol::calculate_adol_aqol6d(aqol_tb, prefix_1L_chr = "aqol",id_var_nm_1L_chr = "v1")) %>%
  dplyr::select(dplyr::starts_with("uaqol")) %>%
  dplyr::mutate(diff_with_8D = uaqol_FB - uaqol6Dusing8D,
                diff_with_8Da = uaqol_FB - uaqol6Dusing8Da,
                diff_adol_with_adult = uaqol_adol - uaqol_FB)
#comparison_tb
```

As the below summary illustrates, there is little difference in results between the two implementations.

```{r}
summary(comparison_tb)
```
